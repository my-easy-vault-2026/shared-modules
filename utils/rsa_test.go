package utils

import (
	"crypto/rand"
	"crypto/rsa"
	"crypto/sha1"
	"crypto/x509"
	"encoding/base64"
	"encoding/pem"
	"fmt"
	"testing"
)

func TestGenRsaKey(t *testing.T) {

	prikey, pubkey, err := GenRsaKey()

	t.Log(string(pubkey), string(prikey), err)

	sign, err := RsaSignWithSha256([]byte("xxxxxxxxxxxxxxxx"), prikey)

	t.Log(base64.StdEncoding.EncodeToString(sign))

	_, err = RsaVerifySignWithSha256([]byte("xxxxxxxxxxxxxxxx"), sign, pubkey)

	t.Log(err)

}

func TestRsaDecrypt(t *testing.T) {

	// 	key := `-----BEGIN RSA PRIVATE KEY-----
	// MIIEpAIBAAKCAQEAzn88MgWItkxYeUt5jWeRBYIiQEUFxstgYJx8tYblZ55psnYd
	// HwhsyoPDwG6eq0r60WFSEeP2QFqV1qceYuDNM2RziIaMMGYgYlCPjgYaiMda3wlX
	// 0w6pMv/5VaJA6N0jcb2m5xBC3I7XqKkP3l9AfL5xCtWN71wmVA/WXVZQ755pC3YE
	// A4IMoOcXs/+143HWZarX7wULhK55c8uAeA1q3ZmL7boLkzBZdMQM6Qlv9DDVcgUH
	// dahk4MiibmOubXrOk12KAyEXZlLH8Sc3qTDQnYP60ZOz95Ffly2c5/6/vLEBP99y
	// J9baXwgoBpQ7amA2o+X7v+eomV5CUItJITR0FwIDAQABAoIBAQDJvT529DcjOqU5
	// I0aGoobpJcEGnyhMlkb7PAcOZdLbj8Vdp809k0KN+3sUFj6HxMIUKws+FUNwjc9T
	// nYOvQEbZjard1+1AH5ZF1sTZERd9R558xij6NpmRDMlwIwtdNSa6qXlUxus7hYYl
	// 7b1mGBLtjDTuS8LV9WYwvCRGndyGq6489o5OHzkHrCSabPXhBWai9LLgYkjrF1v4
	// mo4LCCqJEjaLAdqOlUXLiM1DrDWYlGUqJhdqYmcdl85BBQjisfOrQoET5yKb+afP
	// r8ZNyY3AFKhwmSl5wHNcu1aY7E8UCzLYBboXd1vaWsXzo28UrUEk6jAQFW3otd3r
	// bUM+RhqBAoGBAP1r8fhSTh/DBaCU3CGPX6p3tRNhfWbpMt6nYVvuDVVWb46BvSmJ
	// W2BHK4Me8W+Bx6TKFGFI9eBsa6mevAT1R4283c1ji2pMe6W9uuojAe2ei3nRIYIi
	// eHrmMGLv/3EVO8ctn9OyevQuBXjEIcaNoxkTNwgln4mKonVwJctkDIlXAoGBANCZ
	// EkO840ZRQV8rYjEYJrE7W6hP+7FdTc/O62Gx5g6Kv11M7WY0dGJ0V/deio5sgmmV
	// +Hi4SYQEzG30VZS8QIzaXFOO3etuIbobf7HW7wP3sCsY0kYZpxGiu30luO3OOnvs
	// MLZ6wkdaArxAn1CPpmC3VngPy09cUVjAmun4mPNBAoGADP0eXsrhJDGbtTpL+hBe
	// J9+Q0Vh60+554/2SOOL/nfMbLqOprVpT66BaM5M/bqapM+IDn2Tc7U7BSeVP37Uu
	// oK4gdCl4+M7Iu5r43I1EyQgKQAke/YuEv0/TBQ8l+YbMFI5bFb+dG6zMLP9od8PE
	// q0FX3bwH7EXFw90mosES/2sCgYBKlcDTGZHGDb2rEq8MUM9c5ZVzTA35sBvnZtwA
	// 1YQlxPSBnsTvm2fV4DWnzFUMcb37lNUADRy0KKcT1Z5YDSujcVw7wESXLoy+p6Bz
	// 7R8PMxv5fOmKiReUlbQmHjvOQ8PjlWMhjCk1K/j4aL7OJl7eDA/N5A/U83ReoJeD
	// exDtQQKBgQD51uzxVgwUZNLkJbXCp64TNqUXdvy8+PlhqD9zU9QSpdsf2F0xM4gX
	// eF2r3FU8Ps9WD6SijD715A4o4/xVV7vUXKn11nVqeEkaEkn3KIZpFQiEdWQR2J9e
	// vErFndT9x8gfBgnKj4o6XvqHHPOPoqAC2piaXkLMhQGupqF922bj+Q==
	// -----END RSA PRIVATE KEY-----`

	key := `LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBem44OE1nV0l0a3hZZVV0NWpXZVJCWUlpUUVVRnhzdGdZSng4dFlibFo1NXBzbllkCkh3aHN5b1BEd0c2ZXEwcjYwV0ZTRWVQMlFGcVYxcWNlWXVETk0yUnppSWFNTUdZZ1lsQ1BqZ1lhaU1kYTN3bFgKMHc2cE12LzVWYUpBNk4wamNiMm01eEJDM0k3WHFLa1AzbDlBZkw1eEN0V043MXdtVkEvV1hWWlE3NTVwQzNZRQpBNElNb09jWHMvKzE0M0hXWmFyWDd3VUxoSzU1Yzh1QWVBMXEzWm1MN2JvTGt6QlpkTVFNNlFsdjlERFZjZ1VICmRhaGs0TWlpYm1PdWJYck9rMTJLQXlFWFpsTEg4U2MzcVREUW5ZUDYwWk96OTVGZmx5MmM1LzYvdkxFQlA5OXkKSjliYVh3Z29CcFE3YW1BMm8rWDd2K2VvbVY1Q1VJdEpJVFIwRndJREFRQUJBb0lCQVFESnZUNTI5RGNqT3FVNQpJMGFHb29icEpjRUdueWhNbGtiN1BBY09aZExiajhWZHA4MDlrMEtOKzNzVUZqNkh4TUlVS3dzK0ZVTndqYzlUCm5ZT3ZRRWJaamFyZDErMUFINVpGMXNUWkVSZDlSNTU4eGlqNk5wbVJETWx3SXd0ZE5TYTZxWGxVeHVzN2hZWWwKN2IxbUdCTHRqRFR1UzhMVjlXWXd2Q1JHbmR5R3E2NDg5bzVPSHprSHJDU2FiUFhoQldhaTlMTGdZa2pyRjF2NAptbzRMQ0NxSkVqYUxBZHFPbFVYTGlNMURyRFdZbEdVcUpoZHFZbWNkbDg1QkJRamlzZk9yUW9FVDV5S2IrYWZQCnI4Wk55WTNBRktod21TbDV3SE5jdTFhWTdFOFVDekxZQmJvWGQxdmFXc1h6bzI4VXJVRWs2akFRRlczb3RkM3IKYlVNK1JocUJBb0dCQVAxcjhmaFNUaC9EQmFDVTNDR1BYNnAzdFJOaGZXYnBNdDZuWVZ2dURWVldiNDZCdlNtSgpXMkJISzRNZThXK0J4NlRLRkdGSTllQnNhNm1ldkFUMVI0MjgzYzFqaTJwTWU2Vzl1dW9qQWUyZWkzblJJWUlpCmVIcm1NR0x2LzNFVk84Y3RuOU95ZXZRdUJYakVJY2FOb3hrVE53Z2xuNG1Lb25Wd0pjdGtESWxYQW9HQkFOQ1oKRWtPODQwWlJRVjhyWWpFWUpyRTdXNmhQKzdGZFRjL082Mkd4NWc2S3YxMU03V1kwZEdKMFYvZGVpbzVzZ21tVgorSGk0U1lRRXpHMzBWWlM4UUl6YVhGT08zZXR1SWJvYmY3SFc3d1Azc0NzWTBrWVpweEdpdTMwbHVPM09PbnZzCk1MWjZ3a2RhQXJ4QW4xQ1BwbUMzVm5nUHkwOWNVVmpBbXVuNG1QTkJBb0dBRFAwZVhzcmhKREdidFRwTCtoQmUKSjkrUTBWaDYwKzU1NC8yU09PTC9uZk1iTHFPcHJWcFQ2NkJhTTVNL2JxYXBNK0lEbjJUYzdVN0JTZVZQMzdVdQpvSzRnZENsNCtNN0l1NXI0M0kxRXlRZ0tRQWtlL1l1RXYwL1RCUThsK1liTUZJNWJGYitkRzZ6TUxQOW9kOFBFCnEwRlgzYndIN0VYRnc5MG1vc0VTLzJzQ2dZQktsY0RUR1pIR0RiMnJFcThNVU05YzVaVnpUQTM1c0J2blp0d0EKMVlRbHhQU0Juc1R2bTJmVjREV256RlVNY2IzN2xOVUFEUnkwS0tjVDFaNVlEU3VqY1Z3N3dFU1hMb3krcDZCego3UjhQTXh2NWZPbUtpUmVVbGJRbUhqdk9ROFBqbFdNaGpDazFLL2o0YUw3T0psN2VEQS9ONUEvVTgzUmVvSmVECmV4RHRRUUtCZ1FENTF1enhWZ3dVWk5Ma0piWENwNjRUTnFVWGR2eTgrUGxocUQ5elU5UVNwZHNmMkYweE00Z1gKZUYycjNGVThQczlXRDZTaWpENzE1QTRvNC94VlY3dlVYS24xMW5WcWVFa2FFa24zS0lacEZRaUVkV1FSMko5ZQp2RXJGbmRUOXg4Z2ZCZ25LajRvNlh2cUhIUE9Qb3FBQzJwaWFYa0xNaFFHdXBxRjkyMmJqK1E9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=`

	data := `TrPUSOlJ7PLhYH9eOXU+TuFXn/q4Ypd2Rk69WlSOVRmLMwA4ET6V1oPVFqqKkCBUzCaZevKi8SVZ+BvlUMnI9SydrcUx/yAJewDpAgxl+IiBwpNSuzX0rQI2yx5pOhHIrisLINvk6T3F78vpqrqngKkPz26KAwO75iQKkTgniwbtlDS/nfxjr1THgs9pkCpfYtjtYQKnKDLb1Z0P1TBNCanxAfl3ga/6tB6ZO61PIcgZVrlALczn1lJs3bJ6ywbODyAcm92uehJgiuhhcDohfpKX5/zxUfi7EXM1T+i1QXsGK7BRbjlja2chdIrt7myyV/q6liRmjVqVAOOEr+6F8Q==`

	decKey, err := base64.URLEncoding.DecodeString(key)
	t.Log(err)
	t.Log(string(decKey))

	decData, err := base64.StdEncoding.DecodeString(data)
	t.Log(err)
	fmt.Println(decData)
	t.Log(string(decData))

	oriData, err := RsaDecryptOAEP([]byte(decData), []byte(decKey))
	t.Log(err)
	t.Log(string(oriData))
}

func TestRsaDecrypt2(t *testing.T) {

	key := `LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRQ3lJeWdzNzZ1enNOd00Kd2VnOFY0L2I5aHdyWUdyVi9CUDVnVXptbjJHUVJ1ZWlRN05vTGRMVmxRQzluVGJYZ0tpdjNzSkQwYlZjcXN4MgpFYyszeHRnMEY5Zy9WM2RUanVCaHlHVmlCOWo2V0ZHVE5hMWdsMzhoNHdVdkpqNTdnWHkzMlRwOHdnMnZXTXJUCkw2UFRydXZVSE5VM0xyVjdVOURmYlo3NXdxMmdVZm9BRlhONGhPNXR5dVE4a3EvYmNWNkM3VW14MTc5QVloeFEKQ3dlZVN2eWRidmJDRUhwU0NhcjNGRDZ5NnhqOXprc2t0QkRSVCtwTmF4eEZjODVLbUhESUVndlE1YlZXU2UyTwptM21YSHRxWVk0QmxUcytzR0JoYS9UREsvQzFBU3pySHN4UGZFaG9TVExiUW40YzFTcTNSMW4zcndvUkV6ekRiClJhSHc2L2xaQWdNQkFBRUNnZ0VBZWNRcWJEMFFRMjQ3bk1UWGVKZnFFRk4xQWZtUVRlRlh6ZytpZjJxbkNEWlAKazgxdlQyRXpZeWZOTDgvTmN4WFJPUmF0K0NuYkxSTGJYRUhrbVJ6bElRYkRuTml2Q29ENXhCMTFuOEw1Z0hicQpuQlB2QmIzSSsyTHhZajlrS294aXNsRmM5M2EyWUF2ejZOUUJ5bXNoYlFhZ2dHMy9RK1FSUFFqenlJcFlvT01EClY4MSsveTZGVUEwOGtTbVlZZlpWc2NQcjNBOGNvanU5UFNUd0h4aWhBTG1ydTV2b0Y5MEw0TTMzeVhkeGJWYVcKUFpwSzJKVUkvUzh3VVhhNldOdzFWcnZkcEVEd2FPcCtucGdSL2lMcHIzR2R1MkM1N0FiMURPdUZQYVVCL3BwOAp3S0FuWm5yckVUQXN1alZOdVA0VkJGM0E2TFRZNDBUSkFKQ2MwbnRGNFFLQmdRRG91WVN1RmQ3YURtb1VkSFoyCmVBdGFxbm1lQnhMa2d6QkQ2NzBHalZPQTN0OHU4K3B4eFc4YzEwWDBjUElXMS8wUzZtR25HOWdKcjRHakJ6U0oKSFRzZ0loMjZYR3VzS0wwWnYzUVpOY21heGJ0cXFwT214NkU2bW9mci85ODNLOGlzVzdZd0NoZFg0MjRxdHNZSAptRjdBUjJCcGZWRnRPaWhHaHlXU3BaWXlwUUtCZ1FERDlBZ0VlejgwSG9td242eFk5VHEvR1ZrdUczY3duQVovCmJ5bE1VNXI4dkplTXRhaDVweG5zSGl3ZWxEaUR3cTVycFd1NXpJS04rN3Q1Y2ZVd0lJK09YeEIzUXY4MEp2QmQKckFjKytNazRvY2RFbzk3TXMzOUNxOWtpbDBma0ZOOTZlNitzeVM3U0VhTllXUkJOSS9VU00rcDBjY3E0SEdvbwpKQXVZQUxEeHBRS0JnQUdoUXYraElaVnZZbWpRUkFBaWFSbnlkYldZb1JZK29Qam96c01iL0VpN3h0NWlVUE1KCkNmVXV3TXVzZXRXVUg2NmhPNXZiQXhGV1RGY2k5c2c3RHkzemJ6ZmQ2OWNoMWVrM1FRM29KWWhTK0RRUUM4YXcKUVQzUzFUN2U1T1pUQlMzSDJxZk5la3BnU21ZOEwzamdKVkc5Ymp4dTUwSVhsUzZoUmE4WVA4d05Bb0dBTDRYQgpaQVRYNFRYK3dwMFcyVVF3Q1NTR29rMzY3QWtLOG1EdExSdWhuT1hJQTFJVEY5M1V4WlRUc2w3VURmQnJDS1JICnFmblZOOFh6UTVMRm1mUnJuR1dsd3FhMjZkai90bGdBTWQ5NFBZbk9uL0QyR2NMMmZCN2RQQ3hnUFFwcTRIT2EKdVZiWlNnMEpCbVlqTS9JaWYxV2o2TFdvS2xxSnpFNWhtVzJoZkJrQ2dZRUFoTUcxY1FiMzNZdEhVWDNCZ3k2SApVYmxQZWZTVTljY2pSZzhYcUVIT0hDQ0xpQXh2K0xidHVwN0NvSjh6NXdJZG9KUGFXTTJ3dGRwTmIxbm5uYk9OClJ5NUxOVXIzU0NJK2JGZFA2NGJIWm4yZzE4UTdmZ2d3d3lpY2w1VW1KZHIrUk9pMDRKd05KVEJzWnFTelpKMTIKMHB4VFY2TzJTcDNGRmQ0QTRBUHFXMGs9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0=`

	data := `CQ2eZXsY5q6zYmY/sGqIVDWvZJsIVn6x+QMloB7hgSg6g2te9r5akALvtHT9+xoMbhlDciJLAM5Ne3RsD0fOZANWnAhEElXye2RJrn7NIOsEbxjKgzZDQGcvxIZRq4ektZWC2mt7PvpZIhpNMqaSIUYqDPN/WbcIe6fZO18G+vxZh20xgPHF3TnrGwZhwyQh07PYwwGAD57+WWXqkOzv6+nh8NdVqGBl26J7qGxy70IF35QVNgqPkGO5tcKGsa9ie6fSVSBUgQaUsrFE0MiNr24tVn5FqRTzfJx1uaHaPEE0UNBbJ/ZnzJEoUe0xQsJsSzBLpJXc5wNyX50bxJOS4g==`

	decKey, err := base64.URLEncoding.DecodeString(key)
	t.Log(err)
	t.Log(string(decKey))

	decData, err := base64.StdEncoding.DecodeString(data)
	t.Log(err)
	fmt.Println(decData)
	t.Log(string(decData))

	oriData, err := RsaDecryptOAEP([]byte(decData), []byte(decKey))
	t.Log(err)
	t.Log(string(oriData))
}

func TestRsaDecrypt3(t *testing.T) {
	var publicKeyData = `-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAygGoUiTD+LjwZIgwFZyj
iibWNQ2LM9xZ2pjKQGP8iUBtAuAW629/Ofw8qxToMyixPrG4A7j8+KOPwYrWPGV6
Og//4zm3cG+1hQvnNUWtMjHHBY8OByUPQ6/T8XHER1DxFBfnWfFLZ1yFX6oNNuvt
LgOreI6ehehJd5IB/4mOjMvFEBgOEejado2n55VNdcFpdQ3RcvGV+f/rl/lsIM08
QvL3lc5gqawj53sW9YZi1DL/uN48R+ghvAYhtx2jpHDBvlH1NCF1rU6CynYsgV9Q
Iksv0ihwl4T+k5F9ir0uv0WIS6kKKS1SRpAprRKunos4PlE8l2+jC6LaJUPhDZlj
/wIDAQAB
-----END PUBLIC KEY-----
`
	var privateKeyData = `
-----BEGIN RSA PRIVATE KEY-----
MIIEogIBAAKCAQEAygGoUiTD+LjwZIgwFZyjiibWNQ2LM9xZ2pjKQGP8iUBtAuAW
629/Ofw8qxToMyixPrG4A7j8+KOPwYrWPGV6Og//4zm3cG+1hQvnNUWtMjHHBY8O
ByUPQ6/T8XHER1DxFBfnWfFLZ1yFX6oNNuvtLgOreI6ehehJd5IB/4mOjMvFEBgO
Eejado2n55VNdcFpdQ3RcvGV+f/rl/lsIM08QvL3lc5gqawj53sW9YZi1DL/uN48
R+ghvAYhtx2jpHDBvlH1NCF1rU6CynYsgV9QIksv0ihwl4T+k5F9ir0uv0WIS6kK
KS1SRpAprRKunos4PlE8l2+jC6LaJUPhDZlj/wIDAQABAoIBAHIcX5YPeLie2AUi
PW9n7aYT7DtJ7FGebw+h8dZP5Q8vWqUeKzRR5p+90hOemtCTcxSEVfucWyKlWoat
Q/oYJOR5t0YHi40zPWnr4G7ibkUFg3Sra/QzRh0pTON+La9PlO+R1TmkqcC4rgrt
R8u3mGK+5fUTM49XOXEXBJPyg5kaXQpiA4BoIRdRnCSitNxWA8kxMkQYJYlwAYab
cKo4Ik/J6+YGG7m2FtrUAWpWVUMBzEYOmGJ7JhSJ1u0UC/Oh1HOS1xlGopkmexbd
EygY3hTNWzHmYaYcYQs0f+8aVcVL64Gm0dtqvAHNnBvudMThhQgdYPc39mNLbrwI
ks4uS8ECgYEA9XfvcGKsNrHA0nqoPUPMT0Nfvv/4XCaKOYk25brH4LbqJPm6CiU6
uNlKFQsxzHPmx7OEK7EYVVZCbSO9s4t/xCzDVNbOZ9kDL6bkTX9DArLE4d6IRF/1
WW/AlNPuwVgxl0kcJILFtLqA1WoC5UWMhbYe2YB/Q3rCozmn0AiwyqECgYEA0qxd
KClKAMIsrB0WJ9gZEsJOpFi4q4g6T1BwT40Xj6Ul6o6DHi6hFhPgZAstqmnY0ANz
ezQ2yxtIm7zSy7S+nwDUycjY9riJcomc/YQZNA2QVM16hEv84VLwH1MVV2wkTb41
DWjbcg/ZNofZHl9AQIw7es+R3mmtDN+8BZOZSp8CgYBHtwmaUQm1VQtbswAyHfuz
8KApgklCSvQ5SRBj38UDrw0LTnZ+/k+Ar+MH8ORUskvrblQgG7ZbQD9Z+YYzzX6/
hsBuqe9Vwb4/jsfGqHagdDA3OTegmlRpE9A06xInJKggZfi15gry+UYok7dS2pXq
fsHWk8capOP2oiKYEeHs4QKBgF2KcLaDVrtte/5Tz+GTHtbodZidWCm5jAJpeeSo
hfye3G4AJxHArH+sBacGG5md88mwrpbWwTl/fMbBmWsfbsAU02ZhCozJtSWpGo6q
F7K4DwzIS4zwXHEDrWCLOF+fwaLPQKkalM1ZYh3HRc0ph9LhMQu/nEn/6/laYhar
yZWLAoGASvCrpFKn0qllMKNUetBmYFpgtjmnNuW7l0xT2UftkW6AuFjU19gKgXhe
I+uZciHQ8kIUHfNLYBbhETsF3iqsklKfeoIr23zYHLE5GpoC151IpKf4guoPbCHX
a1oCDuZm//f5HMePb9juJN0WR//d5jWuizAycZf41XoEd8Bqydg=
-----END RSA PRIVATE KEY-----
`
	pubKeyBlock, _ := pem.Decode([]byte(publicKeyData))
	hash := sha1.New()
	random := rand.Reader
	msg := []byte("helloworldjemyme")
	var pub *rsa.PublicKey
	pubInterface, parseErr := x509.ParsePKIXPublicKey(pubKeyBlock.Bytes)
	if parseErr != nil {
		fmt.Println("Load public key error")
		panic(parseErr)
	}
	pub = pubInterface.(*rsa.PublicKey)
	encryptedData, encryptErr := rsa.EncryptOAEP(hash, random, pub, msg, nil)
	if encryptErr != nil {
		fmt.Println("Encrypt data error")
		panic(encryptErr)
	}
	encodedData := base64.URLEncoding.EncodeToString(encryptedData)
	fmt.Println(encodedData)
	fmt.Println()
	fmt.Println("------I AM JUST A LINE------")
	fmt.Println()
	privateKeyBlock, _ := pem.Decode([]byte(privateKeyData))
	var pri *rsa.PrivateKey
	pri, parseErr = x509.ParsePKCS1PrivateKey(privateKeyBlock.Bytes)
	if parseErr != nil {
		fmt.Println("Load private key error")
		panic(parseErr)
	}
	decryptedData, decryptErr := rsa.DecryptOAEP(hash, random, pri, encryptedData, nil)
	if decryptErr != nil {
		fmt.Println("Decrypt data error")
		panic(decryptErr)
	}
	fmt.Println(string(decryptedData))
}
